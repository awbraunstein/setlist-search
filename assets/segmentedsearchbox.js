var SegmentedSearchbox=function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){this._lookup={},this._currentFocus=-1,this._el=e,this.setupSearchbox(),"string"==typeof t?this.fetchConfig(t):this.setupWithConfig(t)}return e.prototype.validateConfig=function(e){for(var t={},n=0,o=e.valueKinds;n<o.length;n++){var r=o[n];void 0===r.ignoreCase&&(r.ignoreCase=!0);for(var i=0,s=r.values;i<s.length;i++){var a=s[i];if(void 0===a.text&&(a.text=a.data),t[a.text])return!1;t[a.text]=!0}}return!0},e.prototype.getCurrentSbText=function(){for(var e=0;e<this._sb.childNodes.length;e++){var t=this._sb.childNodes[e];if(3===t.nodeType)return t.textContent||""}return""},e.prototype.updateInputValue=function(){for(var e=[],t=this._sb.getElementsByTagName("span"),n=0;n<t.length;n++){var o=t[n].dataset.value;o&&e.push(o)}this._el.value=e.join(" ")},e.prototype.ensureSbHasContent=function(){var e=this._sb.childNodes.length;if(0!=e&&3!=this._sb.childNodes[e-1].nodeType){var t=document.createTextNode(String.fromCharCode(160));this._sb.appendChild(t),this._sb.focus(),document.getSelection().collapse(t,1)}},e.prototype.createSpanForSb=function(e,t,n){var o=document.createElement("span");return o.classList.add("segmented-searchbox-valid-item"),o.textContent=e,o.style.backgroundColor=t,o.dataset.value=n,o.contentEditable="false",o},e.prototype.insertValueIntoSb=function(e){for(var t=0;t<this._sb.childNodes.length;t++){var n=this._sb.childNodes[t];if(3===n.nodeType){var o=this.createSpanForSb(e.dataset.text||"",e.dataset.color||"",e.dataset.value||"");return n.parentNode.insertBefore(o,n),n.parentNode.removeChild(n),this.ensureSbHasContent(),void this.updateInputValue()}}},e.prototype.isInputValueAtEnd=function(){for(var e=0;e<this._sb.childNodes.length-1;e++)if(3===this._sb.childNodes[e].nodeType)return!1;return!0},e.prototype.onInput=function(e){var t=this.getCurrentSbText();if(this.isInputValueAtEnd()&&!t){for(var n=this._sb.childNodes.length-1;n>=0;n--){var o=this._sb.childNodes[n];if("SPAN"==o.nodeName){o.parentNode.removeChild(o);break}}this.ensureSbHasContent()}if(this.updateInputValue(),this.closeList(),!t)return!1;this._currentFocus=-1;var r=function(e){var n=t.trim(),o=e;if(i._lookup[e].ignoreCase&&(n=n.toLowerCase(),o=o.toLowerCase()),n&&o.indexOf(n)>-1){var r=document.createElement("div");r.dataset.text=e,r.dataset.value=i._lookup[e].data,r.dataset.color=i._lookup[e].color,r.innerText=e;var s=i;r.addEventListener("click",function(e){s.insertValueIntoSb(r),s.closeList(),s._sb.focus()}),i._dropDown.appendChild(r)}},i=this;for(var s in this._lookup)r(s);this._dropDown.hidden=!1},e.prototype.onKeydown=function(e){var t=this._dropDown.getElementsByTagName("div");if(t.length)40==e.keyCode?(this._currentFocus++,this.setActive(t)):38==e.keyCode?(this._currentFocus--,this.setActive(t)):13==e.keyCode&&(e.preventDefault(),this._currentFocus>-1?t[this._currentFocus].click():t[0].click(),1==t.length&&t[0].click());else if(13==e.keyCode){e.preventDefault();var n=this._el.closest("form");n&&n.submit()}},e.prototype.setActive=function(e){this.removeActive(e),this._currentFocus>=e.length&&(this._currentFocus=0),this._currentFocus<0&&(this._currentFocus=e.length-1),e[this._currentFocus].classList.add("autocomplete-active")},e.prototype.removeActive=function(e){for(var t=0;t<e.length;t++)e[t].classList.remove("autocomplete-active")},e.prototype.closeList=function(){this._dropDown.hidden=!0,this._dropDown.innerHTML=""},e.prototype.setupSearchbox=function(){var e=this;this._el.style.display="none",this._container=document.createElement("div"),this._container.classList.add("segmented-searchbox-container"),this._sb=document.createElement("div"),this._sb.classList.add("segmented-searchbox-input"),this._container.appendChild(this._sb),this._dropDown=document.createElement("div"),this._dropDown.classList.add("segmented-searchbox-dropdown"),this._container.appendChild(this._dropDown),this._el.parentNode.insertBefore(this._container,this._el.nextSibling),this._sb.addEventListener("input",function(t){e.onInput(t)}),this._sb.addEventListener("keydown",function(t){e.onKeydown(t)})},e.prototype.renderFromInputValue=function(){var e=this._el.value;if(e){var t={};for(var n in this._lookup){var o=this._lookup[n];o.data in t&&t[o.data].text.length<n.length||(t[o.data]={color:o.color,text:n})}for(var r=0,i=e.split(/\s+|([\(\)])/);r<i.length;r++){var s=i[r];if(s){if(!(s in t))return void console.log("Query part: "+s+" is invalid.");var a=t[s],u=this.createSpanForSb(a.text,a.color,s);this._sb.appendChild(u)}}this.updateInputValue(),this.ensureSbHasContent()}},e.prototype.createLookup=function(e){for(var t={},n=0,o=e.valueKinds;n<o.length;n++)for(var r=o[n],i=0,s=r.values;i<s.length;i++){var a=s[i];t[a.text]={color:r.color,data:a.data,ignoreCase:r.ignoreCase}}return t},e.prototype.fetchConfig=function(e){var t=this,n=new XMLHttpRequest;n.responseType="json",n.onreadystatechange=function(){4===n.readyState&&t.setupWithConfig(n.response)},n.open("GET",e),n.send()},e.prototype.setupWithConfig=function(e){if(!this.validateConfig(e))throw new Error("Config contains duplicate values and is invalid.");this._lookup=this.createLookup(e),this._sb.contentEditable="true",this.renderFromInputValue()},e}(),r=function(){function e(){this.searchboxes={}}return e.getInstance=function(){return e._instance||(e._instance=new e),e._instance},e.prototype.addSearchbox=function(e,t){if(!e.id)throw new Error("The provided element must have an id.");if("INPUT"!==e.tagName)throw new Error("The provided element must be of type input.");this.searchboxes[e.id]=new o(e,t)},e}();t.initSearchbox=function(e,t){r.getInstance().addSearchbox(e,t)}}]);